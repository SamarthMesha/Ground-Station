<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <!-- Add Orbitron font for futuristic look -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Add Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Add JetBrains Mono font -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4lE8R4_q3acw6D3Sz1ptUd0N55OY_0xY&callback=initMap" async defer></script>
    <title>Space Club RIT - Ground Station</title>
</head>
<body>
    <!-- Refresh Warning Notification -->
    <div class="refresh-warning" id="refreshWarning">
        <div class="ignition-access-title">COUNTDOWN ACTIVE</div>
        <div class="ignition-notification-message">
            Countdown sequence is currently active. Page refresh is not allowed during countdown.
        </div>
        <div class="ignition-countdown-controls">
            <button class="ignition-control-btn" id="continueBtn">CONTINUE</button>
        </div>
    </div>

    <!-- Main Header -->
    <header>
        <div class="header-left">
            <div class="logo-wrapper">
                <img src="https://media.licdn.com/dms/image/D560BAQHuKpEmVJCp3A/company-logo_200_200/0/1698327707879/space_club_rit_logo?e=2147483647&v=beta&t=LB8J_uFC7qTSwsu1Y5DPjBv0CYfzJ2gK7uuhh8n3SdI" 
                     alt="Space Club RIT Logo" id="club-logo">
                <div class="club-name">
                    <h1>SPACE CLUB RIT</h1>
                </div>
            </div>
        </div>
        
        <!-- EKLAVYA centered in header -->
        <div class="header-center">
            <div class="eklavya-main">EKLAVYA</div>
        </div>
        
        <!-- Empty right side for balance -->
        <div class="header-right"></div>
    </header>

    <!-- Menu Bar (Below Header) -->
    <div class="menu-bar">
        <div class="menu-toggle-wrapper">
            <div class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
                <span class="menu-text">MISSION CONTROL MENU</span>
            </div>
        </div>
        
        <div class="csv-buttons-wrapper">
            <!-- Add Ignition Button here -->
            <button id="ignition-control-btn" class="csv-btn ignition-btn">
                <i class="fas fa-fire"></i>
                <span>Ignition Control</span>
            </button>
            
            <button id="download-data-csv" class="csv-btn data-csv">
                <i class="fas fa-file-csv"></i>
                <span>Data CSV</span>
            </button>
            <button id="download-graphs-csv" class="csv-btn graph-csv">
                <i class="fas fa-chart-bar"></i>
                <span>Graphs CSV</span>
            </button>
        </div>
    </div>

    <!-- Ignition Control Overlay (full-screen) -->
    <div class="ignition-overlay" id="ignition-overlay">
        <div class="ignition-container" id="ignition-container">
            <!-- Login will be loaded here initially -->
        </div>
        <button class="close-ignition-btn" id="close-ignition-btn">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Hamburger Menu Overlay -->
    <div class="menu-overlay" id="menu-overlay">
        <div class="menu-close" id="menu-close">
            <i class="fas fa-times"></i>
        </div>
        <div class="menu-content">
            <div class="menu-header">
                <h2>MISSION CONTROL PANELS</h2>
                <div class="mission-status">
                    <span class="status-dot active"></span>
                    <span class="status-text">MISSION ACTIVE</span>
                </div>
            </div>
            
            <div class="menu-grid">
                <!-- Performance Analysis (Now contains Primary Telemetry) -->
                <div class="menu-card" data-panel="performance">
                    <div class="menu-card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="menu-card-content">
                        <h3>PERFORMANCE ANALYSIS</h3>
                        <p>Telemetry and data visualization</p>
                        <div class="menu-card-subitems">
                            <span class="subitem">Primary Telemetry Data</span>
                            <span class="subitem">Acceleration Vectors vs Time</span>
                            <span class="subitem">Temperature vs Altitude</span>
                            <span class="subitem">Altitude vs Time</span>
                            <span class="subitem">Pressure vs Altitude</span>
                        </div>
                    </div>
                    <div class="menu-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- Trajectory Analysis -->
                <div class="menu-card" data-panel="trajectory">
                    <div class="menu-card-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="menu-card-content">
                        <h3>TRAJECTORY ANALYSIS</h3>
                        <p>Flight path and trajectory visualization</p>
                        <div class="menu-card-subitems">
                            <span class="subitem">Altitude vs Range</span>
                            <span class="subitem">Trajectory Parameters</span>
                            <span class="subitem">Max Altitude Tracking</span>
                        </div>
                    </div>
                    <div class="menu-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                
                <!-- Data Log Section -->
                <div class="menu-card" data-panel="data-log">
                    <div class="menu-card-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="menu-card-content">
                        <h3>DATA LOG</h3>
                        <p>Complete telemetry log and history</p>
                        <div class="menu-card-subitems">
                            <span class="subitem">Telemetry History</span>
                            <span class="subitem">System Events Log</span>
                        </div>
                    </div>
                    <div class="menu-card-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <div class="menu-footer">
                <button id="connect-system-btn" class="control-btn connect-btn">
                    <i class="fas fa-plug"></i>
                    <span>Connect System</span>
                </button>
                <button id="disconnect-system-btn" class="control-btn disconnect-btn" style="display: none;">
                    <i class="fas fa-plug"></i>
                    <span>Disconnect System</span>
                </button>
                <button id="reset-button" class="control-btn reset-btn">
                    <i class="fas fa-redo"></i>
                    <span>Reset Mission</span>
                </button>
            </div>
        </div>
    </div>

    <main>
        <!-- Main Dashboard Layout - Split into two equal columns -->
        <div class="main-dashboard">
            <!-- Left Column: GPS Live Tracking -->
            <div class="dashboard-column">
                <section id="gps-live-section" class="card-container">
                    <div class="card-header">
                        <h2><i class="fas fa-globe-americas"></i> LIVE GPS TRACKING</h2>
                        <div class="map-controls">

                            </button>
                        </div>
                    </div>
                    <div class="tracking-container">
                        <div class="map-container">
                            <div class="map-wrapper">
                                <div id="google-map"></div>
                                <div class="map-overlay">
                                    <div class="map-coordinates">
                                        <div class="coord-item">
                                            <span class="coord-label"><i class="fas fa-map-pin"></i> Lat:</span>
                                            <span class="coord-value" id="map-lat">--.--°</span>
                                        </div>
                                        <div class="coord-item">
                                            <span class="coord-label"><i class="fas fa-map-pin"></i> Lon:</span>
                                            <span class="coord-value" id="map-lon">--.--°</span>
                                        </div>
                                        <div class="coord-item">
                                            <span class="coord-label"><i class="fas fa-mountain"></i> Alt:</span>
                                            <span class="coord-value" id="map-alt">-- m</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tracking-data">
                            <div class="tracking-card">
                                <h4><i class="fas fa-satellite"></i> POSITION & NAVIGATION</h4>
                                <div class="tracking-grid">
                                    <div class="tracking-item">
                                        <div class="tracking-label">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>Latitude</span>
                                        </div>
                                        <div class="tracking-value" id="gps-latitude">--.--° N</div>
                                    </div>
                                    <div class="tracking-item">
                                        <div class="tracking-label">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span>Longitude</span>
                                        </div>
                                        <div class="tracking-value" id="gps-longitude">--.--° E</div>
                                    </div>
                                    <div class="tracking-item">
                                        <div class="tracking-label">
                                            <i class="fas fa-mountain"></i>
                                            <span>Altitude</span>
                                        </div>
                                        <div class="tracking-value" id="gps-altitude">-- m</div>
                                    </div>
                                    <div class="tracking-item">
                                        <div class="tracking-label">
                                            <i class="fas fa-satellite"></i>
                                            <span>GPS</span>
                                        </div>
                                        <div class="tracking-value" id="gps-satellites">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Right Column: 3D Rocket Animation -->
            <div class="dashboard-column">
                <section id="rocket-animation-section" class="card-container">
                    <div class="card-header">
                        <h2><i class="fas fa-rocket"></i> 3D ROCKET ANIMATION</h2>
                    </div>
                    <div class="rocket-visualization">
                        <div class="rocket-container">
                            <div id="rocket3d"></div>
                            <div class="rocket-overlay">
                                <div class="rocket-stats">
                                    <div class="stat-item">
                                        <span class="stat-label"><i class="fas fa-compass"></i> Orientation:</span>
                                        <span class="stat-value" id="rocket-orientation">Stable</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label"><i class="fas fa-tachometer-alt"></i> Rotation X:</span>
                                        <span class="stat-value" id="rocket-rotation-x">0°</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label"><i class="fas fa-tachometer-alt"></i> Rotation Y:</span>
                                        <span class="stat-value" id="rocket-rotation-y">0°</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label"><i class="fas fa-tachometer-alt"></i> Rotation Z:</span>
                                        <span class="stat-value" id="rocket-rotation-z">0°</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Performance Analysis Panel (Now includes Primary Telemetry) -->
        <section id="performance-panel" class="panel-container hidden">
            <div class="panel-header">
                <button class="panel-back-btn" data-panel="performance">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Menu</span>
                </button>
                <h2><i class="fas fa-chart-line"></i> PERFORMANCE ANALYSIS</h2>
                <div class="panel-controls">
                    <div class="chart-metrics">
                    </div>
                </div>
            </div>
            
            <!-- Primary Telemetry Section (Moved to Performance Analysis) -->
            <section id="primary-telemetry" class="card-container">
                <div class="card-header">
                    <h2><i class="fas fa-satellite-dish"></i> PRIMARY TELEMETRY</h2>
                    <div class="telemetry-status">
                        <button id="download-telemetry-btn" class="telemetry-download-btn">
                            <i class="fas fa-download"></i>
                            <span>Download Telemetry</span>
                        </button>
                    </div>
                </div>
                <div class="telemetry-grid">
                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-map-marker-alt"></i> POSITION DATA</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">Altitude</span>
                                <span class="telemetry-value scientific-value" id="altitude">-- m</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Downrange</span>
                                <span class="telemetry-value scientific-value" id="downrange">-- m</span>
                            </div>
                        </div>
                    </div>

                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-tachometer-alt"></i> ACCELERATION</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">Accel X (Ax)</span>
                                <span class="telemetry-value scientific-value" id="accel-x">-- G</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Accel Y (Ay)</span>
                                <span class="telemetry-value scientific-value" id="accel-y">-- G</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Accel Z (Az)</span>
                                <span class="telemetry-value scientific-value" id="accel-z">-- G</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Total Accel</span>
                                <span class="telemetry-value scientific-value" id="total-accel">-- G</span>
                            </div>
                        </div>
                    </div>

                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-compass"></i> ORIENTATION</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">Roll (Φ)</span>
                                <span class="telemetry-value scientific-value" id="roll">--°</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Pitch (θ)</span>
                                <span class="telemetry-value scientific-value" id="pitch">--°</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Yaw (Ψ)</span>
                                <span class="telemetry-value scientific-value" id="yaw">--°</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Angular Rate</span>
                                <span class="telemetry-value scientific-value" id="angular-rate">--°/s</span>
                            </div>
                        </div>
                    </div>

                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-heartbeat"></i> SYSTEM STATUS</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">Ignition</span>
                                <span class="telemetry-value status" id="ignition-status" data-status="critical">NOT IGNITED</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Comm Status</span>
                                <span class="telemetry-value status" id="comm-status" data-status="critical">NO DATA</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">GPS Satellites</span>
                                <span class="telemetry-value scientific-value" id="gps-sats">--</span>
                            </div>
                            <div class="telemetry-row">
                                <span class="telemetry-label">Temperature</span>
                                <span class="telemetry-value scientific-value" id="temperature">-- °C</span>
                            </div>
                        </div>
                    </div>

                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-thermometer-half"></i> THERMOCOUPLE DATA</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">TC1 - Nose Cone</span>
                                <span class="telemetry-value scientific-value" id="thermocouple-1">-- °C</span>
                            </div>
                        </div>
                    </div>

                    <div class="telemetry-card">
                        <div class="telemetry-header">
                            <h3><i class="fas fa-weight-hanging"></i> STRAIN GAUGE DATA</h3>
                        </div>
                        <div class="telemetry-body">
                            <div class="telemetry-row">
                                <span class="telemetry-label">SG1 - Nose Joint</span>
                                <span class="telemetry-value scientific-value" id="strain-gauge-1">-- µε</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Performance Charts Section -->
            <div class="chart-row">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-running"></i> ACCELERATION VECTORS vs TIME</h3>
                        <div class="chart-controls">
                            <button class="chart-btn download-csv-btn" data-chart="acceleration">
                                <i class="fas fa-file-csv"></i>
                                CSV
                            </button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="accelerationChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-thermometer-half"></i> TEMPERATURE vs ALTITUDE</h3>
                        <div class="chart-controls">
                            <button class="chart-btn download-csv-btn" data-chart="temperature">
                                <i class="fas fa-file-csv"></i>
                                CSV
                            </button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="chart-row">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-mountain"></i> ALTITUDE vs TIME</h3>
                        <div class="chart-controls">
                            <button class="chart-btn download-csv-btn" data-chart="altitude">
                                <i class="fas fa-file-csv"></i>
                                CSV
                            </button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="altitudeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3><i class="fas fa-weight-hanging"></i> PRESSURE vs ALTITUDE</h3>
                        <div class="chart-controls">
                            <button class="chart-btn download-csv-btn" data-chart="pressure">
                                <i class="fas fa-file-csv"></i>
                                CSV
                            </button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="pressureChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trajectory Analysis Panel -->
        <section id="trajectory-panel" class="panel-container hidden">
            <div class="panel-header">
                <button class="panel-back-btn" data-panel="trajectory">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Menu</span>
                </button>
                <h2><i class="fas fa-project-diagram"></i> TRAJECTORY ANALYSIS</h2>
                <div class="panel-controls">
                    <div class="trajectory-metrics">
                        <div class="metric-item">
                            <i class="fas fa-arrow-up"></i>
                            Max Altitude: <span id="max-altitude">-- m</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="trajectory-container">
                <div class="trajectory-chart">
                    <div class="trajectory-header">
                        <h3><i class="fas fa-chart-area"></i> ALTITUDE vs RANGE</h3>
                        <div class="trajectory-stats">
                            <div class="stat">
                                <i class="fas fa-mountain"></i>
                                Current Altitude: <span id="current-altitude">-- m</span>
                            </div>
                            <div class="stat">
                                <i class="fas fa-route"></i>
                                Downrange: <span id="downrange-distance">-- km</span>
                            </div>
                        </div>
                        <div class="trajectory-download">
                            <button class="download-trajectory-btn" id="download-trajectory-csv">
                                <i class="fas fa-file-csv"></i>
                                Download CSV
                            </button>
                        </div>
                    </div>
                    <div class="trajectory-wrapper">
                        <canvas id="trajectoryChart"></canvas>
                    </div>
                </div>
                
                <div class="trajectory-data">
                    <div class="data-box">
                        <h4><i class="fas fa-sliders-h"></i> TRAJECTORY PARAMETERS</h4>
                        <div class="trajectory-param">
                            <span><i class="fas fa-mountain"></i> Current Altitude</span>
                            <span id="traj-current-altitude">-- m</span>
                        </div>
                        <div class="trajectory-param">
                            <span><i class="fas fa-arrow-down"></i> Descent Altitude</span>
                            <span id="descent-altitude">-- m</span>
                        </div>
                        <div class="trajectory-param">
                            <span><i class="fas fa-fire"></i> Ignition Time</span>
                            <span id="ignition-time">--:--</span>
                        </div>
                        <div class="trajectory-param">
                            <span><i class="fas fa-wind"></i> Max Q Altitude</span>
                            <span id="maxq-alt">-- m</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Log Panel -->
        <section id="data-log-panel" class="panel-container hidden">
            <div class="panel-header">
                <button class="panel-back-btn" data-panel="data-log">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Menu</span>
                </button>
                <h2><i class="fas fa-clipboard-list"></i> TELEMETRY DATA LOG</h2>
            </div>
            <div class="log-container" id="telemetry-log">
                <div class="log-entry">
                    <span class="log-time">--:--:--</span>
                    <span class="log-data">[SYSTEM] Mission Control initialized. Waiting for sensor initialization...</span>
                </div>
            </div>
        </section>
    </main>

    <!-- Firebase SDK for Telemetry Data -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Your web app's Firebase configuration for Telemetry Data
        const firebaseTelemetryConfig = {
            apiKey: "AIzaSyApK9p7x2nzPEjN2Cq8SVbE_x5cR37zQ6Y",
            authDomain: "eklavya-telemetry-data.firebaseapp.com",
            databaseURL: "https://eklavya-telemetry-data-default-rtdb.firebaseio.com",
            projectId: "eklavya-telemetry-data",
            storageBucket: "eklavya-telemetry-data.firebasestorage.app",
            messagingSenderId: "987654321098",
            appId: "1:987654321098:web:abcdef1234567890",
            measurementId: "G-ABCDEF1234"
        };

        // Initialize Firebase for Telemetry
        const telemetryApp = initializeApp(firebaseTelemetryConfig, "telemetryApp");
        const telemetryDatabase = getDatabase(telemetryApp);
        
        // Make Telemetry Firebase available globally
        window.firebaseTelemetryApp = telemetryApp;
        window.firebaseTelemetryDatabase = telemetryDatabase;
        
        console.log("Firebase Telemetry System initialized successfully");
        
        // Function to save telemetry data to Firebase
        window.saveTelemetryToFirebase = async function(telemetryData) {
            try {
                const telemetryRef = ref(telemetryDatabase, 'telemetry/latest');
                await set(telemetryRef, telemetryData);
                
                // Also push to history
                const historyRef = ref(telemetryDatabase, 'telemetry/history');
                await push(historyRef, {
                    ...telemetryData,
                    timestamp: Date.now()
                });
                
                console.log("Telemetry saved to Firebase:", telemetryData);
                return true;
            } catch (error) {
                console.error("Error saving telemetry to Firebase:", error);
                return false;
            }
        };
        
        // Function to get live telemetry from Firebase
        window.getLiveTelemetryFromFirebase = function(callback) {
            try {
                const telemetryRef = ref(telemetryDatabase, 'telemetry/latest');
                onValue(telemetryRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        callback(data);
                    }
                });
                return true;
            } catch (error) {
                console.error("Error getting live telemetry:", error);
                return false;
            }
        };
        
        // Function to get telemetry history from Firebase
        window.getTelemetryHistoryFromFirebase = async function(limit = 100) {
            try {
                const historyRef = ref(telemetryDatabase, 'telemetry/history');
                const snapshot = await get(historyRef);
                const history = [];
                
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        history.push({
                            id: childSnapshot.key,
                            ...childSnapshot.val()
                        });
                    });
                }
                
                // Sort by timestamp and limit results
                return history
                    .sort((a, b) => b.timestamp - a.timestamp)
                    .slice(0, limit);
            } catch (error) {
                console.error("Error getting telemetry history:", error);
                return [];
            }
        };
    </script>

    <script src="script.js"></script>
</body>
</html>
